<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Client failover configuration </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Client failover configuration ">
    <meta name="generator" content="docfx 2.59.1.0">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../content/index.html" width="46">
                <img id="logo" src="../../../../content/main/shared-content/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="ClientFailoverConfiguration">
<h1 id="client-failover-configuration">Client failover configuration</h1>

<p>You can configure the adapter for failover by using client failover to register the adapter to a failover group managed by a failover endpoint. When you register the adapter to a failover group it allows the adapter to work with other adapter instances in the group as mutual backups. This minimizes the likelihood of data loss if an adapter in the group goes offline due to incidences like scheduled maintenance or an unexpected power outage.</p>
<p>Using client failover, you can do the following:</p>
<ul>
<li>Register the adapter instance to a failover group managed by a failover endpoint.</li>
<li>Unregister the adapter instance from a failover group managed by a failover endpoint.</li>
<li>Perform runtime failover parameter changes such as the failover mode and failover timeout.</li>
<li>Query the current failover state including the failover role, last data process time, failover status and adapter state.</li>
</ul>
<p><strong>Note:</strong> Failover group will be created by the adapter if it does not exist on the failover endpoint.</p>
<h2 id="configure-client-failover">Configure client failover</h2>
<p>Complete the following steps to configure client failover.</p>
<ol>
<li><p>Using a text editor, create a file that contains the client failover configuration in the JSON format.</p>
<ul>
<li>For sample JSON, see the <a href="#example-client-failover-configuration">example client failover configuration</a>.</li>
<li>For all available parameters, see the <a href="#client-failover-parameters">client failover parameters</a>.</li>
</ul>
</li>
<li><p>Save the file. For example, <code>ConfigureClientFailover.json</code>.</p>
</li>
<li><p>Use any of the <a class="xref" href="configuration-tools.html">Configuration tools</a> capable of making HTTP requests to run a PUT command with the contents of the file to the following endpoint: <code>https://&lt;hostname&gt;:&lt;port&gt;/api/v1/ClientFailover</code>.</p>
<p> <strong>Note:</strong> <code>5590</code> is the default port number. If you selected a different port number, replace it with that value.</p>
<p> Example using <code>curl</code>:</p>
<p> <strong>Note:</strong> Run this command from the same directory where the file is located.</p>
<pre><code class="lang-bash">curl -d &quot;@ConfigureClientFailover.json&quot; -H &quot;Content-Type: application/json&quot; -X PUT &quot;https://&lt;hostname&gt;:&lt;port&gt;/api/v1/ClientFailover&quot;
</code></pre></li>
</ol>
<p>On successful execution, the client failover change takes effect immediately during runtime.</p>
<h2 id="client-failover-parameters">Client failover parameters</h2>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>FailoverGroupId</strong></td>
<td>Required</td>
<td><code>string</code></td>
<td>The ID of the failover group to register the adapter instance in <br><br>Allowed value: any string identifier<br>Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>Name</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The friendly name of the failover group <br><br>Allowed value: any string value<br>Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The description of the failover group <br><br>Allowed value: any string value<br>Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>FailoverTimeout</strong></td>
<td>Required</td>
<td><code>datetime</code></td>
<td>The failover timeout value of the failover group. This defines how frequently the adapter will send a heartbeat to the failover endpoint. The heartbeat will be sent at every FailoverTimeout / 2 interval <br><br>Allowed value: a string representation of date time using <code>hh:mm:ss</code> <br></td>
</tr>
<tr>
<td><strong>Mode</strong></td>
<td>Required</td>
<td><code>string</code></td>
<td>The failover mode of the registered adapter <br><br>Allowed value: <code>Hot</code>, <code>Warm</code>, <code>Cold</code> <br> For more information, see <a href="#failover-modes">Failover Modes</a>.</td>
</tr>
<tr>
<td><strong>Endpoint</strong></td>
<td>Required</td>
<td><code>string</code></td>
<td>The URL of a destination that supports client failover registration. Supported destinations include ADH and on-premise Failover Service <br><br>Allowed value: well-formed http or https endpoint string<br>Default: <code>null</code></td>
</tr>
<tr>
<td><strong>UserName</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The username used for Basic authentication to on-premise Failover Service endpoint <br><br>Allowed value: any string<br>Default: <code>null</code><br><br><strong>Note:</strong> If your username contains a backslash, you must add an escape character, for example, type <code>OilCompany\TestUser</code> as <code>OilCompany\\TestUser</code>.</td>
</tr>
<tr>
<td><strong>Password</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>The password used for Basic authentication to on-premise Failover Service endpoint <br><br>Allowed value: any string or <code>{{&lt;secretId&gt;}}</code> (see <a href="xref:ReferenceSecrets">Reference Secrets</a>)<br>Default: <code>null</code></td>
</tr>
<tr>
<td><strong>ClientId</strong></td>
<td>Required for ADH endpoint</td>
<td><code>string</code></td>
<td>The clientId used for Bearer authentication to ADH endpoint <br><br>Allowed value: any string, can be null if the endpoint URL schema is <code>HTTP</code><br>Default: <code>null</code></td>
</tr>
<tr>
<td><strong>ClientSecret</strong></td>
<td>Required for ADH endpoint</td>
<td><code>string</code></td>
<td>The clientSecret used for Bearer authentication to ADH endpoint <br><br>Allowed value: any string or <code>{{&lt;secretId&gt;}}</code> (see <a href="xref:ReferenceSecrets">Reference Secrets</a>)<br>Default: <code>null</code></td>
</tr>
<tr>
<td><strong>TokenEndpoint</strong></td>
<td>Optional</td>
<td><code>string</code></td>
<td>An optional token endpoint where the adapter retrieves a bearer token. When null or not specified the adapter uses a well-known Open ID URL to retrieve it <br><br>Allowed value: well-formed http or https endpoint string <br>Default value: <code>null</code></td>
</tr>
<tr>
<td><strong>ValidateEndpointCertificate</strong></td>
<td>Optional</td>
<td><code>boolean</code></td>
<td>An optional Boolean flag where, when set to false, the adapter will disable the verification of the server certificate <br><br><strong>Note:</strong> AVEVA strongly recommends only disabling server certificate validation for testing purposes. <br><br>Allowed value: <code>true</code> or <code>false</code><br>Default value: <code>true</code></td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Failover group name, description and failover timeout cannot be changed once created. To change it the group must be deleted on the failover service side.</p>
<h3 id="failover-modes">Failover Modes</h3>
<p>The failover behavior outlined below corresponds to adapter instances with the &#39;Secondary&#39; failover role. Available failover modes may vary based on adapter. For more information on failover role, see <a href="#failover-role">Failover Role</a>.</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Hot</strong></td>
<td>When in <code>Hot</code> failover mode, configured components for the <code>Secondary</code> adapter instance start and collect data from the data source. Collected data is buffered into the failover-specific buffer folder until the adapter instance in the <code>Primary</code> role has finished sending data to the destination. Data from the <code>Secondary</code> adapter instance is not egressed to the data endpoint(s).</td>
</tr>
<tr>
<td><strong>Warm</strong></td>
<td>When in <code>Warm</code> failover mode, configured components for the <code>Secondary</code> adapter instance start and connect to the data source but do not collect data from the data source. Since data is not being collected, data is not buffered nor egressed to the data endpoint(s).</td>
</tr>
<tr>
<td><strong>Cold</strong></td>
<td>When in <code>Cold</code> failover mode, none of the configured components for the <code>Secondary</code> adapter instance start. The adapter does not connect to nor collect data from the data source, and data is not egressed to the data endpoint(s).</td>
</tr>
</tbody>
</table>
<h2 id="example-client-failover-configuration">Example client failover configuration</h2>
<p>The following is an example of a complete client failover configuration.</p>
<pre><code class="lang-json"> {
   &quot;FailoverGroupId&quot;: &quot;FailoverGroup1&quot;,
   &quot;Name&quot;: &quot;NameExample&quot;,
   &quot;Description&quot;: &quot;DescriptionExample&quot;,
   &quot;FailoverTimeout&quot;: &quot;00:01:00&quot;,
   &quot;Mode&quot;: &quot;hot&quot;,
   &quot;Endpoint&quot;: &quot;http://test-endpoint.com&quot;,
   &quot;UserName&quot;: &quot;UserName1&quot;,
   &quot;Password&quot;: &quot;Password1&quot;,
   &quot;TokenEndpoint&quot;: null,
   &quot;ValidateEndpointCertificate&quot;: true
 }
</code></pre><p><strong>Note:</strong> When On Demand history recovery is required a new AVEVA Adapter instance should be configured to perform the operation. It isn&#39;t recommended to use On Demand history recovery on an Adapter instance that participates in a failover pair. </p>
<h2 id="query-current-failover-state">Query current failover state</h2>
<p>You can query the current failover state with the adapter&#39;s diagnostics. Follow the instruction below to query the current failover state:</p>
<p>Use any of the <a class="xref" href="configuration-tools.html">Configuration tools</a> capable of making HTTP requests to run a GET command to the following endpoint: <code>http://localhost:5590/api/v1/diagnostics/FailoverState</code>.</p>
<p>The following is an example of failover state returned from the adapter:</p>
<pre><code class="lang-json">{
    &quot;Role&quot;: &quot;Primary&quot;,
    &quot;LastDataProcessedTime&quot;: &quot;2021-01-01T00:00:00&quot;,
    &quot;FailoverScore&quot;: &quot;95&quot;,
    &quot;AdapterState&quot;: &quot;Running&quot;
}
</code></pre><h3 id="failover-role">Failover Role</h3>
<p>The current failover <code>Role</code> is determined by the client failover endpoint. The current failover role is visible by querying the failover state, or by looking at the failover status diagnostics streams. For more information on failover status, see <a href="xref:FailoverStatus">Failover Status</a>.</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Primary</strong></td>
<td>When the adapter is in the <code>Primary</code> role, configured components start, collect, and egress data from the data source to the data endpoint(s). <br><br><strong>Note:</strong> While the adapter is in the <code>Primary</code> role, a change in <code>Mode</code> in the client failover configuration does not affect adapter behavior and data will continue to be egressed.</td>
</tr>
<tr>
<td><strong>Secondary</strong></td>
<td>When the adapter is in the <code>Secondary</code> role, adapter behavior varies based on the failover mode. For more information, see <a href="#failover-modes">Failover Modes</a>.</td>
</tr>
</tbody>
</table>
<p>When an adapter with a valid client failover configuration registers with an endpoint and it is the only adapter registered in the group, it becomes the <code>Primary</code> adapter instance. If the adapter is not the only adapter registered in the client failover group, the <code>Primary</code> adapter instance is that with the highest <code>FailoverScore</code> value. For more information on <code>FailoverScore</code>, see <a href="xref:FailoverStatus">Failover Status</a>.</p>
<h2 id="health">Health</h2>
<p>If the adapter has health endpoints configured, the client failover configuration values <code>Mode</code> and <code>FailoverGroupId</code> are included in the static failover health data. For more information, see <a class="xref" href="../health/failover-health.html">Failover Health</a>.</p>
<h2 id="rest-urls">REST URLs</h2>
<table>
<thead>
<tr>
<th>Relative URL</th>
<th>HTTP verb</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>api/v1/configuration/System/ClientFailover</td>
<td>GET</td>
<td>Gets the client failover configuration</td>
</tr>
<tr>
<td>api/v1/configuration/System/ClientFailover</td>
<td>DELETE</td>
<td>Deletes the client failover configuration</td>
</tr>
<tr>
<td>api/v1/configuration/System/ClientFailover</td>
<td>POST</td>
<td>Creates a client failover configuration. Fails if the client failover configuration already exists</td>
</tr>
<tr>
<td>api/v1/configuration/System/ClientFailover</td>
<td>PATCH</td>
<td>Partially updates existing client failover configuration</td>
</tr>
<tr>
<td>api/v1/configuration/System/ClientFailover</td>
<td>PUT</td>
<td>Replaces the existing client failover configuration</td>
</tr>
<tr>
<td>api/v1/diagnostics/FailoverState</td>
<td>GET</td>
<td>Get the current failover state</td>
</tr>
</tbody>
</table>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/PI-Adapter-Modbus-Docs/blob/main/content/main/shared-content/configuration/client-failover.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span><a href="https://www.osisoft.com/copyright/">© 2019 - 2021 OSIsoft, LLC. All rights reserved.</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
